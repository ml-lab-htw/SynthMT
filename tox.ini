# =============================================================================
# SynthMT Tox Configuration
# =============================================================================
# Run tests across multiple Python versions and perform code quality checks.
#
# Usage:
#   tox                    # Run all environments
#   tox -e py311           # Run only Python 3.11 tests
#   tox -e lint            # Run only linting
#   tox -e format          # Check formatting
#   tox -e typecheck       # Run type checking
# =============================================================================

[tox]
env_list =
    py311
    py312
    lint
    format
    typecheck
minversion = 4.0.0
isolated_build = true

# =============================================================================
# Test environments
# =============================================================================

[testenv]
description = Run tests with pytest
package = wheel
wheel_build_env = .pkg
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    python-dotenv>=1.0.0
setenv =
    PYTHONPATH = {toxinidir}
commands =
    pytest {tty:--color=yes} --cov=synth_mt --cov-report=term-missing {posargs:tests}


[testenv:py311]
basepython = python3.11

[testenv:py312]
basepython = python3.12

# =============================================================================
# Code quality environments
# =============================================================================

[testenv:lint]
description = Run linting with ruff
skip_install = true
deps =
    ruff>=0.1.0
commands =
    ruff check synth_mt tests {posargs}

[testenv:format]
description = Check code formatting with black
skip_install = true
deps =
    black>=23.0.0
commands =
    black --check --diff synth_mt tests {posargs}

[testenv:format-fix]
description = Auto-format code with black
skip_install = true
deps =
    black>=23.0.0
commands =
    black synth_mt tests {posargs}

[testenv:typecheck]
description = Run type checking with mypy
deps =
    mypy>=1.0.0
    types-PyYAML
    types-tqdm
    types-requests
commands =
    mypy synth_mt {posargs}

# =============================================================================
# Documentation environment
# =============================================================================

[testenv:docs]
description = Build documentation
deps =
    sphinx>=6.0.0
    sphinx-rtd-theme>=1.2.0
    myst-parser>=1.0.0
commands =
    sphinx-build -b html docs docs/_build/html {posargs}

# =============================================================================
# Development environment
# =============================================================================

[testenv:dev]
description = Development environment with all tools
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    ruff>=0.1.0
    black>=23.0.0
    mypy>=1.0.0
    pre-commit>=3.0.0
commands =
    python -c "print('Development environment ready!')"

# =============================================================================
# CI-specific environment (minimal dependencies)
# =============================================================================

[testenv:ci]
description = CI testing environment
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    python-dotenv>=1.0.0
setenv =
    PYTHONPATH = {toxinidir}
    CI = true
commands =
    pytest {tty:--color=yes} --cov=synth_mt --cov-report=xml {posargs:tests}

# =============================================================================
# Pytest configuration
# =============================================================================

[pytest]
testpaths = tests
python_files = test_*.py
python_functions = test_*
addopts = -v --tb=short
filterwarnings =
    ignore::DeprecationWarning
    ignore::UserWarning

